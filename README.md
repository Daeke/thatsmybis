# That's My BIS; a tool for managing loot council guilds in World of Warcraft Classic

This project was started to give raiders a stronger voice in how loot council distributes loot, help loot council make more informed decisions, and to provide transparency in decision making back to raiders.

In general, decisions made in the development of this project should reflect those objectives. Features that may obfuscates actions and needlessly hide data from raiders should only be implemented with careful consideration, as they may harm the overall objective of this project.

We want to lessen the gap between raiders and raid management, not increase it. Raid management is there to support everyone else in the raid, not act above them.

# Some Technical Details

If you have any questions, reach out on the project's Discord server: [https://discord.gg/HWNUMKK](https://discord.gg/HWNUMKK)

Stack:

- Linux (server is running Ubuntu)
- PHP (Laravel is the framework)
- MaraiDB (almost 1:1 identical to MySQL)
- Nginx
- Javascript (jQuery, DataTables library)
- CSS (Bootstrap 4)

[Laravel Docs](https://laravel.com/docs/7.x). Laravel dictates the file structure of the project and how almost everything is implemented, so they're very useful.

Environment variables are stored in `.env`. These will generally need to be configured when setting up a new environment, and an existing dev can assist you in populating them.

[Composer](https://getcomposer.org/) will need to be run (`composer update`, `composer install`) when setting up a new environment.

The list of routes and what controller functions they map to are located in `routes/web.php`, or `routes/api.php` for API endpoints. These files are a good place to start for learning how to navigate the project for the first time.

Models are located in the `app` directory.

Controllers are located in the `app/Http/Controllers` directory.

Views are located in the `resources/views` directory.

Helper functions are loaded in from `app/helpers.php` and accessible almost anywhere when writing PHP.

Similarly, there are Javascript helper functions stored in `public/js/helpers.js`.

The 'master' template for all page views is `views/layoutes/app.blade.php`. All other pages use this template, populating the 'content' section at the very least.

Javascript and CSS goes through a preprocessor/transpiler before being used in production. These files are stored in `public/js/processed` and `public/css/processed` (though this may change if someone implements a more dynamic system). These **are not** currently (2020-08-12) generated server-side, but rather need to be generated by the developer before merging into master. Generate them with `npm run production` from the root folder.

## Local Environment Setup
The easiest way to get a local envrionment setup is with Laravel's configuration for Vagrant. Vagrant is a tool that makes it relatively painless to spin up a virtual machine containing a standardized dev environment for a specific project. This means that rather than configuring your operating system to have the appropriate packages, webserver, databases, and other requirements for this project, you just download and boot up a virtual machine that already has all that crap set up. This allows many developers to run the same dev environment, reducing troubleshooting and headaches, and putting more focus on the project itself.

Now, there's still going to be a little bit of work and learning curve involved in getting that VM setup. But believe me, it's better than the alternative.

Laravel has a custom environment for Vagrant. They call their environment 'Homestead', and that's what we're going to be setting up. It's easiest to get this up and running on Linux, but it's not much more work to get it running on Windows.

Best place to start? [RTFM](https://www.urbandictionary.com/define.php?term=RTFM): https://laravel.com/docs/7.x/homestead

tl;dr

- Download and install VirtualBox: https://www.virtualbox.org/wiki/Downloads
- Download and install Vagrant: https://www.vagrantup.com/downloads.html
- Download/clone the laravel/homestead repo, run `bash init.sh` (or `init.bat` in Windows), configure `Homestead.yaml`
- Generate .ssh keys or use the ones you have. (In Windows: `ssh-keygen -t rsa -C "your_email@example.com"`)
- A Windows configuration for `Homestead.yaml` looks like this:
    ```
    ---
    ip: "192.168.10.10"
    memory: 2048
    cpus: 2
    provider: virtualbox

    authorize: C:\Users\your_username\.ssh\id_rsa.pub

    keys:
        - C:\Users\your_username\.ssh\id_rsa

    folders:
        - map: C:\projects\thatsmybis
          to: /home/vagrant/code/thatsmybis

    sites:
        - map: thatsmybis.local
          to: /home/vagrant/code/thatsmybis/public

    databases:
        - thatsmybis

    features:
        - mariadb: false
        - ohmyzsh: false
        - webdriver: false

    # ports:
    #     - send: 50000
    #       to: 5000
    #     - send: 7777
    #       to: 777
    #       protocol: udp
    ```
- Make sure the hosts have been setup (read Hostname Resolution in the [docs](https://laravel.com/docs/7.x/homestead#configuring-homestead))
- Run `vagrant up` while in the Homestead directory.
- Run `vagrant ssh`
- Run `composer install` from `/home/vagrant/code/thatsmybis`
- Create a file named `.env` in `/home/vagrant/code/thatsmybis`. Base it off of `.env.example` or ask another dev for what details to fill in.

## Permissions

kodeine\acl library was used for the permissions.

**NOTEWORTHY:** That library expected the User model to be the one with the roles and permissions. We did not use the User model. We used the Member model. Because of that, some references to 'user' or 'user_id' might not make any sense whatsoever. Have fun with that. I sure did. /s

**ALSO:** There's an override. The CheckGuildPermissions middleware will flag someone as a SUPER ADMIN if they're the guild's owner in the DB or (if I implement it), if they're one of the devs. the `hasPermissions()` function in the Member model will allow this flag to override the normal permissions. Science!

## Roles

Roles are loaded from the Discord server.

## Laraval Custom Configurations

- `ONLY_FULL_GROUP_BY` for SQL has been disabled in `database.php` by changing `strict` to `false`. This is to allow for writing simpler `GROUP BY` clauses in queries. If you can fix the `group by` complications caused by `strict`, you're welcome to turn it back on. I tried. It required mutilating my `SELECT` statements, and even then I couldn't get it to 100% work the way it did before 5.7 when it just assumed `ANY_VALUE()` on non-aggregated columns (even when I told it to use `ANY_VALUE()`). Good luck. ([SO thread](https://stackoverflow.com/questions/34115174/error-related-to-only-full-group-by-when-executing-a-query-in-mysql))
