var table=null,colSource=0,colName=1,colPrios=2,colWishlist=3,colReceived=4,colNotes=5,colPriority=6,lastSource=null,offspecVisible=!0;function createTable(a){return itemTable=$("#itemTable").DataTable({autoWidth:!1,data:items,columns:[{title:'<span class="fas fa-fw fa-skull-crossbones"></span> '.concat(headerBoss),data:"",render:function render(a,e,t){return t.source_name&&(thisSource=t.source_name),'\n                    <ul class="no-bullet no-indent mb-0">\n                        '.concat(t.source_name?'\n                            <li>\n                                <span class="font-weight-bold">\n                                    '.concat(t.source_name,"\n                                </span>\n                            </li>"):"","\n                    </ul>")},visible:!0,width:"130px",className:"text-right width-130"},{title:'<span class="fas fa-fw fa-sack text-success"></span> '.concat(headerLoot,' <span class="text-muted small">(').concat(items.length,")</span>"),data:"",render:function render(a,e,t){return getItemLink(t)},visible:!0,width:"330px",className:"width-330"},{title:'<span class="fas fa-fw fa-sort-amount-down text-gold"></span> '.concat(headerPrios),data:guild.is_attendance_hidden?"priod_characters":"priod_characters_with_attendance",render:function render(a,e,t){return a&&a.length?createCharacterListHtml(a,"prio",t.item_id,null):"—"},orderable:!1,visible:!!showPrios,width:"300px",className:"width-300"},{title:'<span class="text-legendary fas fa-fw fa-scroll-old"></span> '.concat(headerWishlist),data:guild.is_attendance_hidden?"wishlist_characters":"wishlist_characters_with_attendance",render:function render(a,e,t){if(a&&a.length){var n="";if(currentWishlistNumber){var c=a.filter(function(a){return a.pivot.list_number==currentWishlistNumber});c.length&&(n=createCharacterListHtml(c,"wishlist",t.item_id,null))}else for(i=1;i<=maxWishlistLists;i++){var s=a.filter(function(a){return a.pivot.list_number==i});if(s.length){var r=null;r=wishlistNames&&wishlistNames[i-1]?wishlistNames[i-1]:headerWishlist+" "+i,n+=createCharacterListHtml(s,"wishlist",t.item_id,r)}}return""==n&&(n="—"),n}return"—"},orderable:!1,visible:!!showWishlist,width:"400px",className:"width-400"},{title:'<span class="text-success fas fa-fw fa-sack"></span> '.concat(headerReceived),data:"received_and_recipe_characters",render:function render(a,e,t){return a&&a.length?createCharacterListHtml(a,"received",t.item_id,null):"—"},orderable:!1,visible:!0,width:"300px",className:"width-300"},{title:'<span class="fas fa-fw fa-comment-alt-lines"></span> '.concat(headerNotes),data:"guild_note",render:function render(a,e,t){return getNotes(t,a)},orderable:!1,visible:!!showNotes,width:"200px",className:"width-200"},{title:'<span class="fas fa-fw fa-comment-alt-lines"></span> '.concat(headerPrioNotes),data:"guild_priority",render:function render(a,e,t){return a?'<span class="js-markdown-inline">'.concat(nl2br(a),"</span>"):"—"},orderable:!1,visible:!!showNotes,width:"200px",className:"width-200"}],order:[],paging:!1,fixedHeader:!0,drawCallback:function drawCallback(){makeWowheadLinks(),parseMarkdown(),trackTimestamps()},initComplete:function initComplete(){makeWowheadLinks(),parseMarkdown()},createdRow:function createdRow(e,t,i){0!=i&&null!=a||(a=t.source_name),t.source_name!=a&&($(e).addClass("top-border"),a=t.source_name)}}),itemTable}function addWishlistFilterHandlers(){$("#wishlist_filter").on("change",function(){currentWishlistNumber=$(this).val(),itemTable.rows().invalidate().draw()}).change()}function createCharacterListHtml(a,e,t){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n='<ul class="list-inline js-item-list mb-0" data-type="'.concat(e,'" data-id="').concat(t,'">');i&&(n+='<li class="js-item-wishlist-character no-bullet font-weight-bold text-muted small">\n            '.concat(i,"\n        </li>"));var c=4,s=null;return $.each(a,function(a,t){if("prio"==e&&t.pivot.raid_group_id&&t.pivot.raid_group_id!=s){s=t.pivot.raid_group_id;var i="";if(raidGroups.length){var c=raidGroups.find(function(a){return a.id===t.pivot.raid_group_id});c&&(i=c.name)}n+='\n                <li data-raid-group-id="" class="js-item-wishlist-character no-bullet font-weight-normal text-muted small">\n                    '.concat(i,"\n                </li>\n            ")}if("wishlist"==e&&(t.raid_group_id&&t.raid_group_id!=s||!t.raid_group_id&&s)){var r="";if(!t.raid_group_id&&s)r="no raid group",s=null;else if(s=t.raid_group_id,raidGroups.length){var o=raidGroups.find(function(a){return a.id===t.raid_group_id});o&&(r=o.name)}n+='\n                <li data-raid-group-id="" class="js-item-wishlist-character no-bullet font-weight-normal text-muted small">\n                    '.concat(r,"\n                </li>\n            ")}n+='\n            <li data-raid-group-id="'.concat("prio"==e?t.pivot.raid_group_id:t.raid_group_id,'"\n                data-offspec="').concat(t.pivot.is_offspec?1:0,'"\n                value="').concat("prio"==e?t.pivot.order:"",'"\n                class="js-item-wishlist-character list-inline-item font-weight-normal mb-1 mr-0 ').concat("received"!=t.pivot.type&&t.pivot.received_at?"font-strikethrough":"",'">\n                <a href="/').concat(guild.id,"/").concat(guild.slug,"/c/").concat(t.id,"/").concat(t.slug,'"\n                    title="').concat(t.raid_group_name?t.raid_group_name+" -":""," ").concat(t.level?t.level:""," ").concat(t.race?t.race:""," ").concat(t.spec?t.spec:""," ").concat(t.class?t.class:""," ").concat(t.raid_count?"(".concat(t.raid_count," raid").concat(t.raid_count>1?"s":""," attended)"):""," ").concat(t.username?"("+t.username+")":"",'"\n                    class="tag text-muted d-inline">\n                    <span class="">').concat("received"!==e&&t.pivot.order?t.pivot.order:"",'</span>\n                    <span class="small font-weight-bold">').concat(t.pivot.is_offspec?"OS":"",'</span>\n                    <span class="role-circle" style="background-color:').concat(getColorFromDec(t.raid_group_color),'"></span>\n                    <span class="text-').concat(t.class?t.class.toLowerCase():"",'-important">').concat(t.name,"</span>\n                    ").concat(t.is_alt?'\n                        <span class="text-warning">'.concat(localeAlt,"</span>\n                    "):"","\n                    ").concat(guild.is_attendance_hidden||!t.attendance_percentage&&!t.raid_count?"":"".concat(t.raid_count&&"number"==typeof t.attendance_percentage?'<span title="attendance" class="smaller '.concat(getAttendanceColor(t.attendance_percentage),'">').concat(Math.round(100*t.attendance_percentage),"%</span>"):"").concat(t.raid_count?'<span class="smaller"> '.concat(t.raid_count,"r</span>"):"","\n                    "),'\n                    <span class="js-watchable-timestamp smaller"\n                        data-timestamp="').concat(t.pivot.created_at,'"\n                        data-is-short="1">\n                    </span>\n                    <span style="display:none;">').concat(t.discord_username," ").concat(t.username,"</span>\n                </a>\n            </li>")}),n+="</ul>"}function getNotes(a,e){var t=null;return e=e?'<span class="js-markdown-inline">'.concat(e?DOMPurify.sanitize(nl2br(e)):"","</span>").concat(""):"—"}function getItemLink(a){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t='data-wowhead-link="https://'.concat(wowheadLocale+wowheadSubdomain,".wowhead.com/item=").concat(a.item_id,'"\n    data-wowhead="item=').concat(a.item_id,"?domain=").concat(wowheadLocale+wowheadSubdomain,'"');e&&(t+=' data-wh-icon-size="'.concat(e,'"'));var i="";return i=guild?"/".concat(guild.id,"/").concat(guild.slug,"/i/").concat(a.item_id,"/").concat(slug(a.name)):"",'\n    <ul class="no-bullet no-indent mb-0">\n        <li>\n            '.concat(guild.tier_mode?'<span class="text-monospace font-weight-medium text-tier-'.concat(a.guild_tier?a.guild_tier:"",'">').concat(a.guild_tier?getItemTierLabel(a,guild.tier_mode):"&nbsp;","</span>"):"",'\n            <a href="').concat(i,'"\n                class="').concat(a.quality?"q"+a.quality:"",'"\n                ').concat(t,">\n                ").concat(a.name,"\n            </a>\n        </li>\n    </ul>")}function hideOffspecItems(){$("[data-offspec='1']").hide()}function showOffspecItems(){$("[data-offspec='1']").show()}$(document).ready(function(){table=createTable(),$(".toggle-column").click(function(a){a.preventDefault();var e=table.column($(this).attr("data-column"));e.visible(!e.visible())}),$(".toggle-column-default").click(function(a){a.preventDefault(),table.column(colName).visible(!0),table.column(colPrios).visible(!0),table.column(colWishlist).visible(!0),table.column(colReceived).visible(!0),table.column(colNotes).visible(!0),table.column(colPriority).visible(!0)}),table.on("column-visibility.dt",function(a,e,t,i){makeWowheadLinks(),trackTimestamps(),parseMarkdown()}),$("#raid_group_filter").on("change",function(){var a=$(this).val();a?($(".js-item-wishlist-character[data-raid-group-id!='"+a+"']").hide(),$(".js-item-wishlist-character[data-raid-group-id='"+a+"']").show()):$(".js-item-wishlist-character").show()}).change(),$(".js-hide-offspec-items").click(function(){offspecVisible?(offspecVisible=!1,hideOffspecItems()):(offspecVisible=!0,showOffspecItems())}),addWishlistFilterHandlers(),trackTimestamps()});
