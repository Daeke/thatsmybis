function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],n=!0,r=!1,c=void 0;try{for(var o=e[Symbol.iterator](),s;!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw c}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function addCharacter(e){var t=!1,a;if(!findExistingCharacter(e).length){var n=$('select[name^=characters][name$=\\[character_id\\]] option:selected[value=""]').first().parent(),r=n.find('option[value="'+e+'"i]');r.val()&&(r.prop("selected",!0).change(),t=!0);var c=n.parent().closest(".js-row");$(c).find("[name^=characters][name$=\\[is_exempt\\]]").prop("checked",!1).change(),$(c).find("[name^=characters][name$=\\[remark_id\\]]").val("").change(),$(c).find("[name^=characters][name$=\\[credit\\]]").bootstrapSlider("setValue",1)}return t}function addWarcraftlogsAttendees(){var e=$("[name^=logs]:visible"),t=[];e.each(function(){$(this).val()&&(log=new URL($(this).val()),log.pathname.split("/").forEach(function(e){16===e.length&&t.push(e)}))}),$(".js-warcraftlogs-attendees-loading-spinner").show(),$("#warcraftlogsLoadingbar").addClass("d-flex").show(),$.ajax({method:"get",data:{codes:t,guild_id:guild.id},dataType:"json",url:"/api/warcraftlogs/attendees",success:function success(e){if($("#warcraftlogsLoadingbar").removeClass("d-flex").hide(),e.length<=0)$(".js-warcraftlogs-attendees-message").html("No attendance data found").show(),setTimeout(function(){return $(".js-warcraftlogs-attendees-message").hide()},7500);else{for(var t=[],a=[],n=[],r=0,c=0,o="Received the following from Warcraft Logs:",s=0,l=Object.entries(e);s<l.length;s++){var d=_slicedToArray(l[s],2),h=d[0],u=d[1];if(console.log("Report ".concat(u.code,":"),u),u.rankedCharacters)for(var f=function _loop(){var e=_slicedToArray(g[m],2),a=e[0],n=e[1];t.find(function(e){return e[0]===n.name})||t.push([n.name?n.name:"unknown",n])},m=0,g=Object.entries(u.rankedCharacters);m<g.length;m++)f();o+='<ul class="mt-3">\n                        <li class="font-weight-bold">\n                            '.concat(u.title,"\n                        </li>\n                        <li>\n                            ").concat(u.rankedCharacters?"".concat(u.rankedCharacters.length," characters"):"0 characters","\n                        </li>\n                        ").concat(u.endTime?'<li class="small text-muted font-weight-normal">'.concat(moment.utc(u.endTime).local().format("ddd, MMM Do YYYY @ h:mm a"),"</li>"):"","\n                        ").concat(u.zone&&u.zone.name?'<li class="small text-muted font-weight-normal">'.concat(u.zone.name,"</li>"):"",'\n                        <li class="small text-muted font-weight-normal">\n                            ID ').concat(u.code,"\n                        </li>\n                    </ul>")}t.sort(function(e,t){return e[0]>t[0]}),t.forEach(function(e){e=e[1];var t=characters.find(function(t){return t.name===e.name});t?(addCharacter(t.id),r++,a=[].concat(_toConsumableArray(a),[getWarcraftlogsCharacterHtml(e)])):n=[].concat(_toConsumableArray(n),[getWarcraftlogsCharacterHtml(e)]),i++}),o+="<ul>\n                    <li>".concat(r," attendees added</li>\n                    ").concat(a.length?'<li class="text-white"><span class="font-weight-bold">Successful:</span> '.concat(a.join(", "),"</li>"):"","\n                    ").concat(n.length?'<li class="text-white"><span class="font-weight-bold">Not found:</span> '.concat(n.join(", "),'</li><li class="text-white">To add these characters, add them to the guild and reload this page</li>'):"","\n                </ul>"),$(".js-warcraftlogs-attendees-message").html(o).show(),addTooltips()}},error:function error(e){}})}function findExistingCharacter(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t?$('select[name^=characters][name$=\\[character_id\\]] option:selected[value="'.concat(e,'"]')).not(t).first():$('select[name^=characters][name$=\\[character_id\\]] option:selected[value="'.concat(e,'"]')).first()}function fillCharactersFromRaid(e){var t=characters.filter(function(t){return t.raid_group_id==e}),a=characters.filter(function(t){return t.secondary_raid_groups.filter(function(t){return t.id==e}).length>0}),n=t.concat(a).sort(function(e,t){return e.name>t.name?1:t.name>e.name?-1:0}),r=0,c=!0,o=!1,s=void 0;try{for(var i=n[Symbol.iterator](),l;!(c=(l=i.next()).done);c=!0){var d;addCharacter(l.value.id),r++}}catch(e){o=!0,s=e}finally{try{c||null==i.return||i.return()}finally{if(o)throw s}}$(".js-raid-group-message").html("".concat(r," attendees added")).show(),setTimeout(function(){return $(".js-raid-group-message").hide()},7500)}function fixSliderLabels(){window.dispatchEvent(new Event("resize"))}function getWarcraftlogsCharacterHtml(e){return'<span class="text-'.concat(e.classID&&WARCRAFTLOGS_CLASSES[e.classID]?WARCRAFTLOGS_CLASSES[e.classID].slug:"",'" title="').concat(e.classID&&WARCRAFTLOGS_CLASSES[e.classID]?WARCRAFTLOGS_CLASSES[e.classID].name:"",'">').concat(e.name,"</span>")}function resetAttendees(){confirm("Are you sure you want to empty and reset the attendee list?")&&($("select[name^=raid_group_id]").val("").change(),$("select[name^=characters][name$=\\[character_id\\]]").val("").change(),$(".js-attendance-skip").prop("checked",!1).change(),$("select[name^=characters][name$=\\[remark_id\\]]").val("").change(),$("[name^=characters][name$=\\[credit\\]]").bootstrapSlider("setValue",1),$("[name^=characters][name$=\\[public_note\\]]").val(""),$("[name^=characters][name$=\\[officer_note\\]]").val(""),$(".js-show-notes").show(),$(".js-notes").hide())}function showNext(e){""!=$(e).val()&&($(e).show(),$(e).parent().next(".js-hide-empty").show())}function showNextCharacter(e){if(""!=$(e).val()){$(e).show();var t=$(e).closest(".js-row").next(".js-hide-empty");t.show(),t.find("select[name^=characters][name$=\\[character_id\\]]").addClass("selectpicker").selectpicker(),fixSliderLabels()}}$(document).ready(function(){var e=!0;warnBeforeLeaving("#editForm"),$.datetimepicker.setLocale(locale||"en"),$(".js-date-input").datetimepicker({format:"Y-m-d H:i:s",inline:!0,step:30,theme:"dark",value:date?moment.utc(date).local().format("YYYY-MM-DD HH:mm:ss"):moment().format("YYYY-MM-DD HH:mm:ss")}),$(".js-date-input").change(),$("[name=raid_group_id\\[\\]]").change(function(){e||$("[name=add_raiders]").prop("checked")&&$(this).val()&&fillCharactersFromRaid($(this).val())}),$("[name^=characters][name$=\\[character_id\\]").change(function(){var t;e||findExistingCharacter($(this).val(),$(this).find(":selected")).length&&$(this).selectpicker("val","").selectpicker("refresh")}),$(".js-show-next").change(function(){showNext(this)}).change(),$(".js-show-next").keyup(function(){showNext(this)}),$(".js-show-next-character").change(function(){showNextCharacter(this)}).change(),$(".js-show-next-character").keyup(function(){showNextCharacter(this)}),$("#addWarcraftlogsAttendees").click(function(){addWarcraftlogsAttendees()}),$(".js-show-notes").click(function(){var e=$(this).data("index");$(this).hide(),$('.js-notes[data-index="'.concat(e,'"]')).show()}),$(".js-attendance-skip").on("change",function(){var e=$(this).data("index");this.checked?($('[data-attendance-input="'.concat(e,'"]')).addClass("disabled").hide(),$('[data-attendance-skip-note="'.concat(e,'"]')).show()):($('[data-attendance-input="'.concat(e,'"]')).removeClass("disabled").show(),$('[data-attendance-skip-note="'.concat(e,'"]')).hide())}).change(),$(".js-clear-attendees").click(function(){resetAttendees()}),e=!1,$(".loadingBarContainer").removeClass("d-flex").hide(),$("#editForm").show(),fixSliderLabels()});
